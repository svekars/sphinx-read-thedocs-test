<!DOCTYPE html>
<html lang="en">



<head>
  <meta name="robots" content="noindex">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../../../../_static/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="../../../../_static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/star-rating.js"></script>
    <script type="text/javascript" src="../../../../_static/js/left-sidebar2.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/popper.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/send-feedback.js"></script>
    <script type="text/javascript" src="../../../../_static/js/fetch-version.js"></script>
    <link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
</head>






  <div class="header-container">
    <div class="container-xxl header-holder tutorials-header" id="header-holder">
      <div class="header-logo-container">
       <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
        </div>
         <div class="main-menu">
          <ul>
            <li class="main-menu-item">
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
                <a class="with-down-arrow">
                  Learn
                </a>
                <div class="resources-dropdown-menu">
                  <a class="nav-dropdown-item" href="https://pytorch.org/get-started">
                    <span class=dropdown-title>Get Started</span>
                    <p>Run PyTorch locally or get started quickly with one of the supported cloud platforms</p>
                  </a>
                  <a class="nav-dropdown-item" href="https://pytorch.org/tutorials">
                    <span class="dropdown-title">Tutorials</span>
                    <p>Whats new in PyTorch tutorials</p>
                  </a>
                  <a class="nav-dropdown-item" href="https://pytorch.org/tutorials/beginner/basics/intro.html">
                    <span class="dropdown-title">Learn the Basics</span>
                    <p>Familiarize yourself with PyTorch concepts and modules</p>
                  </a>
                  <a class="nav-dropdown-item" href="https://pytorch.org/tutorials/recipes/recipes_index.html">
                    <span class="dropdown-title">PyTorch Recipes</span>
                    <p>Bite-size, ready-to-deploy PyTorch code examples</p>
                  </a>
                  <a class="nav-dropdown-item" href="https://pytorch.org/tutorials/beginner/introyt.html">
                    <span class="dropdown-title">Intro to PyTorch - YouTube Series</span>
                    <p>Master PyTorch basics with our engaging YouTube tutorial series</p>
                  </a>
                </div>
            </li>

            <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
                <a class="with-down-arrow">
                  Ecosystem
                </a>
                <div class="resources-dropdown-menu">
                  <a class="nav-dropdown-item" href="https://pytorch.org/ecosystem">
                    <span class="dropdown-title">Tools</span>
                    <p>Learn about the tools and frameworks in the PyTorch Ecosystem</p>
                  </a>
                  <a class="nav-dropdown-item" href="https://pytorch.org/#community-module">
                    <span class=dropdown-title>Community</span>
                    <p>Join the PyTorch developer community to contribute, learn, and get your questions answered</p>
                  </a>
                  <a class="nav-dropdown-item" href="https://discuss.pytorch.org/" target="_blank">
                    <span class=dropdown-title>Forums</span>
                    <p>A place to discuss PyTorch code, issues, install, research</p>
                  </a>
                  <a class="nav-dropdown-item" href="https://pytorch.org/resources">
                    <span class=dropdown-title>Developer Resources</span>
                    <p>Find resources and get questions answered</p>
                  </a>
                  <a class="nav-dropdown-item" href="https://pytorch.org/ecosystem/contributor-awards-2023">
                    <span class="dropdown-title">Contributor Awards - 2023</span>
                    <p>Award winners announced at this year's PyTorch Conference</p>
                  </a>
                </div>
              </div>
            </li>

            <li>
            <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
                <a class="with-down-arrow">
                  Edge
                </a>
                <div class="resources-dropdown-menu">
                  <a class="nav-dropdown-item" href="https://pytorch.org/edge">
                    <span class="dropdown-title">About PyTorch Edge</span>
                    <p>Build innovative and privacy-aware AI experiences for edge devices</p>
                  </a>
                  <a class="nav-dropdown-item" href="https://pytorch.org/executorch-overview">
                    <span class="dropdown-title">ExecuTorch</span>
                    <p>End-to-end solution for enabling on-device inference capabilities across mobile and edge devices</p>
                  </a>
                </div>
              </div>
            </li>

            <li class="main-menu-item">
              <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
                <a class="with-down-arrow">
                  Docs
                </a>
                <div class="resources-dropdown-menu">
                  <a class="nav-dropdown-item" href="https://pytorch.org/docs/stable/index.html">
                    <span class="dropdown-title">PyTorch</span>
                    <p>Explore the documentation for comprehensive guidance on how to use PyTorch</p>
                  </a>
                  <a class="nav-dropdown-item" href="https://pytorch.org/pytorch-domains">
                    <span class="dropdown-title">PyTorch Domains</span>
                    <p>Read the PyTorch Domains documentation to learn more about domain-specific libraries</p>
                  </a>
                </div>
              </div>
            </li>

            <li>
              <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
                <a class="with-down-arrow">
                  Blogs & News
                </a>
                <div class="resources-dropdown-menu">
                  <a class="nav-dropdown-item" href="https://pytorch.org/blog/">
                    <span class="dropdown-title">PyTorch Blog</span>
                    <p>Catch up on the latest technical news and happenings</p>
                  </a>
                   <a class="nav-dropdown-item" href="https://pytorch.org/community-blog">
                    <span class="dropdown-title">Community Blog</span>
                    <p>Stories from the PyTorch ecosystem</p>
                  </a>
                  <a class="nav-dropdown-item" href="https://pytorch.org/videos">
                    <span class="dropdown-title">Videos</span>
                    <p>Learn about the latest PyTorch tutorials, new, and more </p>
                  <a class="nav-dropdown-item" href="https://pytorch.org/community-stories">
                    <span class="dropdown-title">Community Stories</span>
                    <p>Learn how our community solves real, everyday machine learning problems with PyTorch</p>
                  </a>
                  <a class="nav-dropdown-item" href="https://pytorch.org/events">
                    <span class="dropdown-title">Events</span>
                    <p>Find events, webinars, and podcasts</p>
                  </a>
              </div>
            </li>

            <li>
              <div id="resourcesDropdownButton" data-toggle="resources-dropdown" class="resources-dropdown">
                <a class="with-down-arrow">
                  About
                </a>
                <div class="resources-dropdown-menu">
                  <a class="nav-dropdown-item" href="https://pytorch.org/foundation">
                    <span class="dropdown-title">PyTorch Foundation</span>
                    <p>Learn more about the PyTorch Foundation</p>
                  </a>
                  <a class="nav-dropdown-item" href="https://pytorch.org/governing-board">
                    <span class="dropdown-title">Governing Board</span>
                    <p></p>
                  </a>
                </div>
              </div>
            </li>

            <li class="main-menu-item">
              <div class="no-dropdown">
                <a href="https://pytorch.org/join" data-cta="join">
                  Become a Member
                </a>
              </div>
            </li>
            <li>
             <div class="main-menu-item">
               <a href="https://github.com/pytorch/pytorch" class="github-icon">
               </a>
             </div>
            </li>
            <!--- TODO: This block adds the search icon to the nav bar. We will enable it later.
            <li>
              <div class="main-menu-item">
               <a href="https://github.com/pytorch/pytorch" class="search-icon">
               </a>
              </div>
            </li>
            --->
          </ul>
        </div>

        <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
      </div>
    </div>


   <div class="top-navigation-bar" role="navigation" aria-label="Top Navigation Bar">
    <div class="container-xxl" id="top-navigation-bar">
     <div class="nav-container">
          <div class="nav-left">
            <!-- Left-aligned content here -->
            <ul class="nav-links">
                
                    <li><a href="../../../../index.html">Home</a></li>
                
                    <li><a href="../../../../tutorials.html">Tutorials</a></li>
                
            </ul>
          </div>
          <div class="nav-right">
             <div class="nav-right-left">
                <!-- Intentionally left empty -->
             </div>
             <div class="nav-right-right">
                <!-- Content here will be aligned to the right within the right half -->
                <div class="custom-version-dropdown">
                    <button class="dropdown-toggle">Loading...</button> <!-- Initial text while loading -->
                <ul class="dropdown-menu">
                   <!-- Options will be populated by JavaScript -->
                </ul>
                </div>
                <button id="dark-mode-toggle" class="btn btn-sm btn-outline-secondary">
                  <i id="toggle-icon" class="fas fa-moon" aria-hidden="true"></i>
                </button>
                  <a href="https://github.com/pytorch/pytorch_sphinx_theme" class="github-icon-link" target="_blank">
                   <i class="fab fa-github" aria-hidden="true"></i>
                  </a>
              </div>
          </div>
        </div>
     </div>
</div>




<div class="table-of-contents-link-wrapper">
  <span>Table of Contents</span>
  <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
</div>

<body class="pytorch-body" data-feedback-url="https://github.com/pytorch/pytorch/">
  <div class="container-xxl">
    <div class="container">
     <div class="row">
        <div class="col-md-2 primary-sidebar-border">
          <div class="primary-sidebar-flex-container">
            <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
              <!-- Left column for TOC -->
              <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
   <div class="pytorch-side-scroll">
      <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
         <div class="pytorch-left-menu-search">
          

          

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            <div class="toctree-wrapper">
               <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../page1.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../intro/test1.html">Test Page 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../intro/test2.html">Test 2 page</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../page2.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../intro/subintro-page.html">Subintro page home</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../intro/subintro/page1.html">Pytorch 2.4: Getting Started on Intel GPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../intro/subintro/page2.html">FSDP Notes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../page3.html">Test Markdown Page</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/tutorial1.html">Tutorial 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../tutorials/tutorial2.html">Tutorial 2</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../torch.html">torch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nn.html">torch.nn</a></li>
</ul>

            </div>
          
      </div>
   </div>
</nav>
            </nav>
          </div>
        </div>
        <div class="col-md-8">
          <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
            <!-- Middle column for main content -->
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <div class="row">
               <div class="col-md-8">
                     <ol class="breadcrumb">
    <li class="breadcrumb-item">
        <a href="../../../../index.html">
            Home
        </a>
    </li>
    <li class="breadcrumb-item">
        <a href="../../../index.html"
           >
           Module code
        </a>
    </li>
    <li class="breadcrumb-item">
        <a href="../../../torch.html"
           
               accesskey="U"
               class="active"
           >
           torch
        </a>
    </li>
    <li class="breadcrumb-item active">torch.nn.utils.spectral_norm</li>
</ol>

               </div>
               <div class="col-md-4">
                     <div class="rating-flex-container">
  <div class="rating-container">
   <div class="rating-prompt">Rate this Page</div>
    <div class="stars-outer">
          <i class="fa-regular fa-star" title="1 Star" data-behavior="tutorial-rating" data-count="1"></i>
          <i class="fa-regular fa-star" title="2 Stars" data-behavior="tutorial-rating" data-count="2"></i>
          <i class="fa-regular fa-star" title="3 Stars" data-behavior="tutorial-rating" data-count="3"></i>
          <i class="fa-regular fa-star" title="4 Stars" data-behavior="tutorial-rating" data-count="4"></i>
          <i class="fa-regular fa-star" title="5 Stars" data-behavior="tutorial-rating" data-count="5"></i>
    </div>
  </div>
 </div>
</div>
               </div>
               <div class="row"></div>
                  <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
                    <h1>Source code for torch.nn.utils.spectral_norm</h1><div class="highlight"><pre>
<span></span><span class="c1"># mypy: allow-untyped-defs</span>
<span class="sd">&quot;&quot;&quot;Spectral Normalization from https://arxiv.org/abs/1802.05957.&quot;&quot;&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn.functional</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">F</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch.nn.modules</span><span class="w"> </span><span class="kn">import</span> <span class="n">Module</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;SpectralNorm&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SpectralNormLoadStateDictPreHook&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SpectralNormStateDictHook&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spectral_norm&quot;</span><span class="p">,</span>
    <span class="s2">&quot;remove_spectral_norm&quot;</span><span class="p">,</span>
<span class="p">]</span>


<span class="k">class</span><span class="w"> </span><span class="nc">SpectralNorm</span><span class="p">:</span>
    <span class="c1"># Invariant before and after each forward call:</span>
    <span class="c1">#   u = F.normalize(W @ v)</span>
    <span class="c1"># NB: At initialization, this invariant is not enforced</span>

    <span class="n">_version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># At version 1:</span>
    <span class="c1">#   made  `W` not a buffer,</span>
    <span class="c1">#   added `v` as a buffer, and</span>
    <span class="c1">#   made eval mode use `W = u @ W_orig @ v` rather than the stored `W`.</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">n_power_iterations</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span><span class="p">,</span>
        <span class="n">n_power_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-12</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
        <span class="k">if</span> <span class="n">n_power_iterations</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Expected n_power_iterations to be positive, but &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;got n_power_iterations=</span><span class="si">{</span><span class="n">n_power_iterations</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_power_iterations</span> <span class="o">=</span> <span class="n">n_power_iterations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reshape_weight_to_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="n">weight_mat</span> <span class="o">=</span> <span class="n">weight</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># permute dim to front</span>
            <span class="n">weight_mat</span> <span class="o">=</span> <span class="n">weight_mat</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">weight_mat</span><span class="o">.</span><span class="n">dim</span><span class="p">())</span> <span class="k">if</span> <span class="n">d</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">weight_mat</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">weight_mat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_weight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span> <span class="n">Module</span><span class="p">,</span> <span class="n">do_power_iteration</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
        <span class="c1"># NB: If `do_power_iteration` is set, the `u` and `v` vectors are</span>
        <span class="c1">#     updated in power iteration **in-place**. This is very important</span>
        <span class="c1">#     because in `DataParallel` forward, the vectors (being buffers) are</span>
        <span class="c1">#     broadcast from the parallelized module to each module replica,</span>
        <span class="c1">#     which is a new module object created on the fly. And each replica</span>
        <span class="c1">#     runs its own spectral norm power iteration. So simply assigning</span>
        <span class="c1">#     the updated vectors to the module this function runs on will cause</span>
        <span class="c1">#     the update to be lost forever. And the next time the parallelized</span>
        <span class="c1">#     module is replicated, the same randomly initialized vectors are</span>
        <span class="c1">#     broadcast and used!</span>
        <span class="c1">#</span>
        <span class="c1">#     Therefore, to make the change propagate back, we rely on two</span>
        <span class="c1">#     important behaviors (also enforced via tests):</span>
        <span class="c1">#       1. `DataParallel` doesn&#39;t clone storage if the broadcast tensor</span>
        <span class="c1">#          is already on correct device; and it makes sure that the</span>
        <span class="c1">#          parallelized module is already on `device[0]`.</span>
        <span class="c1">#       2. If the out tensor in `out=` kwarg has correct shape, it will</span>
        <span class="c1">#          just fill in the values.</span>
        <span class="c1">#     Therefore, since the same power iteration is performed on all</span>
        <span class="c1">#     devices, simply updating the tensors in-place will make sure that</span>
        <span class="c1">#     the module replica on `device[0]` will update the _u vector on the</span>
        <span class="c1">#     parallelized module (by shared storage).</span>
        <span class="c1">#</span>
        <span class="c1">#    However, after we update `u` and `v` in-place, we need to **clone**</span>
        <span class="c1">#    them before using them to normalize the weight. This is to support</span>
        <span class="c1">#    backproping through two forward passes, e.g., the common pattern in</span>
        <span class="c1">#    GAN training: loss = D(real) - D(fake). Otherwise, engine will</span>
        <span class="c1">#    complain that variables needed to do backward for the first forward</span>
        <span class="c1">#    (i.e., the `u` and `v` vectors) are changed in the second forward.</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_orig&quot;</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_u&quot;</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_v&quot;</span><span class="p">)</span>
        <span class="n">weight_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reshape_weight_to_matrix</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">do_power_iteration</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_power_iterations</span><span class="p">):</span>
                    <span class="c1"># Spectral norm of weight equals to `u^T W v`, where `u` and `v`</span>
                    <span class="c1"># are the first left and right singular vectors.</span>
                    <span class="c1"># This power iteration produces approximations of `u` and `v`.</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span>
                        <span class="n">torch</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span><span class="n">weight_mat</span><span class="o">.</span><span class="n">t</span><span class="p">(),</span> <span class="n">u</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">v</span>
                    <span class="p">)</span>
                    <span class="n">u</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span><span class="n">weight_mat</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">u</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_power_iterations</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># See above on why we need to clone</span>
                    <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">memory_format</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">contiguous_format</span><span class="p">)</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">memory_format</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">contiguous_format</span><span class="p">)</span>

        <span class="n">sigma</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span><span class="n">weight_mat</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">/</span> <span class="n">sigma</span>
        <span class="k">return</span> <span class="n">weight</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span> <span class="n">Module</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_weight</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">do_power_iteration</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="nb">delattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="nb">delattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_u&quot;</span><span class="p">)</span>
        <span class="nb">delattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_v&quot;</span><span class="p">)</span>
        <span class="nb">delattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_orig&quot;</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">register_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span><span class="n">weight</span><span class="o">.</span><span class="n">detach</span><span class="p">()))</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span> <span class="n">Module</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">setattr</span><span class="p">(</span>
            <span class="n">module</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_weight</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">do_power_iteration</span><span class="o">=</span><span class="n">module</span><span class="o">.</span><span class="n">training</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_solve_v_and_rescale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight_mat</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">target_sigma</span><span class="p">):</span>
        <span class="c1"># Tries to returns a vector `v` s.t. `u = F.normalize(W @ v)`</span>
        <span class="c1"># (the invariant at top of this class) and `u @ W @ v = sigma`.</span>
        <span class="c1"># This uses pinverse in case W^T W is not invertible.</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">multi_dot</span><span class="p">(</span>
            <span class="p">[</span><span class="n">weight_mat</span><span class="o">.</span><span class="n">t</span><span class="p">()</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">weight_mat</span><span class="p">)</span><span class="o">.</span><span class="n">pinverse</span><span class="p">(),</span> <span class="n">weight_mat</span><span class="o">.</span><span class="n">t</span><span class="p">(),</span> <span class="n">u</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="n">target_sigma</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">mv</span><span class="p">(</span><span class="n">weight_mat</span><span class="p">,</span> <span class="n">v</span><span class="p">)))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span>
        <span class="n">module</span><span class="p">:</span> <span class="n">Module</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">n_power_iterations</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SpectralNorm&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">hook</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">_forward_pre_hooks</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">SpectralNorm</span><span class="p">)</span> <span class="ow">and</span> <span class="n">hook</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cannot register two spectral_norm hooks on the same parameter </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="n">SpectralNorm</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">n_power_iterations</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">_parameters</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;`SpectralNorm` cannot be applied as parameter `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` is None&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">parameter</span><span class="o">.</span><span class="n">UninitializedParameter</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The module passed to `SpectralNorm` can&#39;t have uninitialized parameters. &quot;</span>
                <span class="s2">&quot;Make sure to run the dummy forward before applying spectral normalization&quot;</span>
            <span class="p">)</span>

        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="n">weight_mat</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">reshape_weight_to_matrix</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>

            <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">weight_mat</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
            <span class="c1"># randomly initialize `u` and `v`</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">weight</span><span class="o">.</span><span class="n">new_empty</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">.</span><span class="n">normal_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">fn</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">weight</span><span class="o">.</span><span class="n">new_empty</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">normal_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">fn</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span>

        <span class="nb">delattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">register_parameter</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_orig&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span>
        <span class="c1"># We still need to assign weight back as fn.name because all sorts of</span>
        <span class="c1"># things may assume that it exists, e.g., when initializing weights.</span>
        <span class="c1"># However, we can&#39;t directly assign as it could be an nn.Parameter and</span>
        <span class="c1"># gets added as a parameter. Instead, we register weight.data as a plain</span>
        <span class="c1"># attribute.</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_u&quot;</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_v&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="n">module</span><span class="o">.</span><span class="n">register_forward_pre_hook</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="n">module</span><span class="o">.</span><span class="n">_register_state_dict_hook</span><span class="p">(</span><span class="n">SpectralNormStateDictHook</span><span class="p">(</span><span class="n">fn</span><span class="p">))</span>
        <span class="n">module</span><span class="o">.</span><span class="n">_register_load_state_dict_pre_hook</span><span class="p">(</span><span class="n">SpectralNormLoadStateDictPreHook</span><span class="p">(</span><span class="n">fn</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">fn</span>


<span class="c1"># This is a top level class because Py2 pickle doesn&#39;t like inner class nor an</span>
<span class="c1"># instancemethod.</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SpectralNormLoadStateDictPreHook</span><span class="p">:</span>
    <span class="c1"># See docstring of SpectralNorm._version on the changes to spectral_norm.</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>

    <span class="c1"># For state_dict with version None, (assuming that it has gone through at</span>
    <span class="c1"># least one training forward), we have</span>
    <span class="c1">#</span>
    <span class="c1">#    u = F.normalize(W_orig @ v)</span>
    <span class="c1">#    W = W_orig / sigma, where sigma = u @ W_orig @ v</span>
    <span class="c1">#</span>
    <span class="c1"># To compute `v`, we solve `W_orig @ x = u`, and let</span>
    <span class="c1">#    v = x / (u @ W_orig @ x) * (W / W_orig).</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">state_dict</span><span class="p">,</span>
        <span class="n">prefix</span><span class="p">,</span>
        <span class="n">local_metadata</span><span class="p">,</span>
        <span class="n">strict</span><span class="p">,</span>
        <span class="n">missing_keys</span><span class="p">,</span>
        <span class="n">unexpected_keys</span><span class="p">,</span>
        <span class="n">error_msgs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">local_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;spectral_norm&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">fn</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.version&quot;</span><span class="p">,</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">version</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">weight_key</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">fn</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">version</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">weight_key</span> <span class="o">+</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">state_dict</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;_orig&quot;</span><span class="p">,</span> <span class="s2">&quot;_u&quot;</span><span class="p">,</span> <span class="s2">&quot;_v&quot;</span><span class="p">))</span>
                <span class="ow">and</span> <span class="n">weight_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state_dict</span>
            <span class="p">):</span>
                <span class="c1"># Detect if it is the updated state dict and just missing metadata.</span>
                <span class="c1"># This could happen if the users are crafting a state dict themselves,</span>
                <span class="c1"># so we just pretend that this is the newest.</span>
                <span class="k">return</span>
            <span class="n">has_missing_keys</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;_orig&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;_u&quot;</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">weight_key</span> <span class="o">+</span> <span class="n">suffix</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state_dict</span><span class="p">:</span>
                    <span class="n">has_missing_keys</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
                        <span class="n">missing_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">has_missing_keys</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
                <span class="n">weight_orig</span> <span class="o">=</span> <span class="n">state_dict</span><span class="p">[</span><span class="n">weight_key</span> <span class="o">+</span> <span class="s2">&quot;_orig&quot;</span><span class="p">]</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="n">state_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">weight_key</span><span class="p">)</span>
                <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">weight_orig</span> <span class="o">/</span> <span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">weight_mat</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">reshape_weight_to_matrix</span><span class="p">(</span><span class="n">weight_orig</span><span class="p">)</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">state_dict</span><span class="p">[</span><span class="n">weight_key</span> <span class="o">+</span> <span class="s2">&quot;_u&quot;</span><span class="p">]</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">_solve_v_and_rescale</span><span class="p">(</span><span class="n">weight_mat</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
                <span class="n">state_dict</span><span class="p">[</span><span class="n">weight_key</span> <span class="o">+</span> <span class="s2">&quot;_v&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>


<span class="c1"># This is a top level class because Py2 pickle doesn&#39;t like inner class nor an</span>
<span class="c1"># instancemethod.</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SpectralNormStateDictHook</span><span class="p">:</span>
    <span class="c1"># See docstring of SpectralNorm._version on the changes to spectral_norm.</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">fn</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">state_dict</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">local_metadata</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;spectral_norm&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">local_metadata</span><span class="p">:</span>
            <span class="n">local_metadata</span><span class="p">[</span><span class="s2">&quot;spectral_norm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.version&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">local_metadata</span><span class="p">[</span><span class="s2">&quot;spectral_norm&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected key in metadata[&#39;spectral_norm&#39;]: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">local_metadata</span><span class="p">[</span><span class="s2">&quot;spectral_norm&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="o">.</span><span class="n">_version</span>


<span class="n">T_module</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T_module&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Module</span><span class="p">)</span>


<div class="viewcode-block" id="spectral_norm">
<a class="viewcode-back" href="../../../../generated/torch.nn.utils.spectral_norm.html#torch.nn.utils.spectral_norm">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">spectral_norm</span><span class="p">(</span>
    <span class="n">module</span><span class="p">:</span> <span class="n">T_module</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span><span class="p">,</span>
    <span class="n">n_power_iterations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-12</span><span class="p">,</span>
    <span class="n">dim</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_module</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Apply spectral normalization to a parameter in the given module.</span>

<span class="sd">    .. math::</span>
<span class="sd">        \mathbf{W}_{SN} = \dfrac{\mathbf{W}}{\sigma(\mathbf{W})},</span>
<span class="sd">        \sigma(\mathbf{W}) = \max_{\mathbf{h}: \mathbf{h} \ne 0} \dfrac{\|\mathbf{W} \mathbf{h}\|_2}{\|\mathbf{h}\|_2}</span>

<span class="sd">    Spectral normalization stabilizes the training of discriminators (critics)</span>
<span class="sd">    in Generative Adversarial Networks (GANs) by rescaling the weight tensor</span>
<span class="sd">    with spectral norm :math:`\sigma` of the weight matrix calculated using</span>
<span class="sd">    power iteration method. If the dimension of the weight tensor is greater</span>
<span class="sd">    than 2, it is reshaped to 2D in power iteration method to get spectral</span>
<span class="sd">    norm. This is implemented via a hook that calculates spectral norm and</span>
<span class="sd">    rescales weight before every :meth:`~Module.forward` call.</span>

<span class="sd">    See `Spectral Normalization for Generative Adversarial Networks`_ .</span>

<span class="sd">    .. _`Spectral Normalization for Generative Adversarial Networks`: https://arxiv.org/abs/1802.05957</span>

<span class="sd">    Args:</span>
<span class="sd">        module (nn.Module): containing module</span>
<span class="sd">        name (str, optional): name of weight parameter</span>
<span class="sd">        n_power_iterations (int, optional): number of power iterations to</span>
<span class="sd">            calculate spectral norm</span>
<span class="sd">        eps (float, optional): epsilon for numerical stability in</span>
<span class="sd">            calculating norms</span>
<span class="sd">        dim (int, optional): dimension corresponding to number of outputs,</span>
<span class="sd">            the default is ``0``, except for modules that are instances of</span>
<span class="sd">            ConvTranspose{1,2,3}d, when it is ``1``</span>

<span class="sd">    Returns:</span>
<span class="sd">        The original module with the spectral norm hook</span>

<span class="sd">    .. note::</span>
<span class="sd">        This function has been reimplemented as</span>
<span class="sd">        :func:`torch.nn.utils.parametrizations.spectral_norm` using the new</span>
<span class="sd">        parametrization functionality in</span>
<span class="sd">        :func:`torch.nn.utils.parametrize.register_parametrization`. Please use</span>
<span class="sd">        the newer version. This function will be deprecated in a future version</span>
<span class="sd">        of PyTorch.</span>

<span class="sd">    Example::</span>

<span class="sd">        &gt;&gt;&gt; m = spectral_norm(nn.Linear(20, 40))</span>
<span class="sd">        &gt;&gt;&gt; m</span>
<span class="sd">        Linear(in_features=20, out_features=40, bias=True)</span>
<span class="sd">        &gt;&gt;&gt; m.weight_u.size()</span>
<span class="sd">        torch.Size([40])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">module</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ConvTranspose1d</span><span class="p">,</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ConvTranspose2d</span><span class="p">,</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ConvTranspose3d</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">):</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">SpectralNorm</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">n_power_iterations</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">module</span></div>



<div class="viewcode-block" id="remove_spectral_norm">
<a class="viewcode-back" href="../../../../generated/torch.nn.utils.remove_spectral_norm.html#torch.nn.utils.remove_spectral_norm">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_spectral_norm</span><span class="p">(</span><span class="n">module</span><span class="p">:</span> <span class="n">T_module</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_module</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Remove the spectral normalization reparameterization from a module.</span>

<span class="sd">    Args:</span>
<span class="sd">        module (Module): containing module</span>
<span class="sd">        name (str, optional): name of weight parameter</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; m = spectral_norm(nn.Linear(40, 10))</span>
<span class="sd">        &gt;&gt;&gt; remove_spectral_norm(m)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">hook</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">_forward_pre_hooks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">SpectralNorm</span><span class="p">)</span> <span class="ow">and</span> <span class="n">hook</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">hook</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">module</span><span class="o">.</span><span class="n">_forward_pre_hooks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;spectral_norm of &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; not found in </span><span class="si">{</span><span class="n">module</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">hook</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">_state_dict_hooks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">SpectralNormStateDictHook</span><span class="p">)</span> <span class="ow">and</span> <span class="n">hook</span><span class="o">.</span><span class="n">fn</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">module</span><span class="o">.</span><span class="n">_state_dict_hooks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">break</span>

    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">hook</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">_load_state_dict_pre_hooks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hook</span><span class="p">,</span> <span class="n">SpectralNormLoadStateDictPreHook</span><span class="p">)</span> <span class="ow">and</span> <span class="n">hook</span><span class="o">.</span><span class="n">fn</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">module</span><span class="o">.</span><span class="n">_load_state_dict_pre_hooks</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">module</span></div>

</pre></div>
                  </article>
              <hr> <!-- Horizontal line -->
              <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
    
    
    </div>

  <div class="feedback">
   <div class="rating-flex-container">
  <div class="rating-container">
   <div class="rating-prompt">Rate this Page</div>
    <div class="stars-outer">
          <i class="fa-regular fa-star" title="1 Star" data-behavior="tutorial-rating" data-count="1"></i>
          <i class="fa-regular fa-star" title="2 Stars" data-behavior="tutorial-rating" data-count="2"></i>
          <i class="fa-regular fa-star" title="3 Stars" data-behavior="tutorial-rating" data-count="3"></i>
          <i class="fa-regular fa-star" title="4 Stars" data-behavior="tutorial-rating" data-count="4"></i>
          <i class="fa-regular fa-star" title="5 Stars" data-behavior="tutorial-rating" data-count="5"></i>
    </div>
  </div>
 </div>
</div>
   <div class="feedback-send">
    <a href="#" class="btn with-right-arrow" onclick="openGitHubIssue()">Send feedback</a>
  </div>

  <div role="contentinfo" class="contentinfo-container">
    <p>
        &copy; Copyright 2024, PyTorch Contributors.
    
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
       </p>
     
 </div>
</footer>
             </div>
         </div>
          <div class="col-md-2 right-sidebar-border right-navigation">
            <div class="right-nav-bar">
            <!-- Right column for local TOC -->
                <div class="pytorch-right-menu">
    <div class="pytorch-side-scroll" id="pytorch-side-scroll-right">
       
    </div>
</div>
            </div>
          </div>
      </section>
     </div>
  </div>
</div>
</body>



<!-- Custom sidebar content goes here, or leave empty to remove -->


<!-- left empty to remove -->


<!-- left empty to remove -->


 <!-- Begin Footer -->
 <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access comprehensive developer documentation for PyTorch</p>
          <a class="with-right-arrow" href="https://pytorch.org/docs/stable/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get in-depth tutorials for beginners and advanced developers</p>
          <a class="with-right-arrow" href="https://pytorch.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Resources</h2>
          <p>Find development resources and get your questions answered</p>
          <a class="with-right-arrow" href="https://pytorch.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pytorch.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/">PyTorch</a></li>
            <li><a href="https://pytorch.org/get-started">Get Started</a></li>
            <li><a href="https://pytorch.org/features">Features</a></li>
            <li><a href="https://pytorch.org/ecosystem">Ecosystem</a></li>
            <li><a href="https://pytorch.org/blog/">Blog</a></li>
            <li><a href="https://github.com/pytorch/pytorch/blob/master/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pytorch.org/resources">Resources</a></li>
            <li><a href="https://pytorch.org/tutorials">Tutorials</a></li>
            <li><a href="https://pytorch.org/docs/stable/index.html">Docs</a></li>
            <li><a href="https://discuss.pytorch.org" target="_blank">Discuss</a></li>
            <li><a href="https://github.com/pytorch/pytorch/issues" target="_blank">Github Issues</a></li>
            <li><a href="https://pytorch.org/assets/brand-guidelines/PyTorch-Brand-Guidelines.pdf" target="_blank">Brand Guidelines</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">Stay up to date</li>
            <li><a href="https://www.facebook.com/pytorch" target="_blank">Facebook</a></li>
            <li><a href="https://twitter.com/pytorch" target="_blank">Twitter</a></li>
            <li><a href="https://www.youtube.com/pytorch" target="_blank">YouTube</a></li>
            <li><a href="https://www.linkedin.com/company/pytorch" target="_blank">LinkedIn</a></li>
          </ul>
          </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">PyTorch Podcasts</li>
            <li><a href="https://open.spotify.com/show/6UzHKeiy368jKfQMKKvJY5" target="_blank">Spotify</a></li>
            <li><a href="https://podcasts.apple.com/us/podcast/pytorch-developer-podcast/id1566080008" target="_blank">Apple</a></li>
            <li><a href="https://www.google.com/podcasts?feed=aHR0cHM6Ly9mZWVkcy5zaW1wbGVjYXN0LmNvbS9PQjVGa0lsOA%3D%3D" target="_blank">Google</a></li>
            <li><a href="https://music.amazon.com/podcasts/7a4e6f0e-26c2-49e9-a478-41bd244197d0/PyTorch-Developer-Podcast?" target="_blank">Amazon</a></li>
          </ul>
         </div>
        </div>

        <div class="privacy-policy">
          <ul>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/terms/" target="_blank">Terms</a></li>
            <li class="privacy-policy-links">|</li>
            <li class="privacy-policy-links"><a href="https://www.linuxfoundation.org/privacy-policy/" target="_blank">Privacy</a></li>
          </ul>
        </div>
        <div class="copyright">
        <p> Copyright The Linux Foundation. The PyTorch Foundation is a project of The Linux Foundation.
          For web site terms of use, trademark policy and other policies applicable to The PyTorch Foundation please see
          <a href="https://www.linuxfoundation.org/policies/">www.linuxfoundation.org/policies/</a>. The PyTorch Foundation supports the PyTorch open source
          project, which has been established as PyTorch Project a Series of LF Projects, LLC. For policies applicable to the PyTorch Project a Series of LF Projects, LLC,
          please see <a href="https://www.lfprojects.org/policies/">www.lfprojects.org/policies/</a>.</p>
      </div>
     </div>

  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebooks Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../../../../_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
             <a class="header-logo" href="https://pytorch.org/" aria-label="PyTorch"></a>
             <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>


    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
           <li class="resources-mobile-menu-title">
             <a>Learn</a>
           </li>
           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://pytorch.org/get-started">Get Started</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials">Tutorials</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials/beginner/basics/intro.html">Learn the Basics</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials/recipes/recipes_index.html">PyTorch Recipes</a>
             </li>
             <li>
               <a href="https://pytorch.org/tutorials/beginner/introyt.html">Introduction to PyTorch - YouTube Series</a>
             </li>
           </ul>
           <li class="resources-mobile-menu-title">
             <a>Ecosystem</a>
           </li>
           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://pytorch.org/ecosystem">Tools</a>
             </li>
             <li>
               <a href="https://pytorch.org/#community-module">Community</a>
             </li>
             <li>
               <a href="https://discuss.pytorch.org/">Forums</a>
             </li>
             <li>
               <a href="https://pytorch.org/resources">Developer Resources</a>
             </li>
             <li>
               <a href="https://pytorch.org/ecosystem/contributor-awards-2023">Contributor Awards - 2023</a>
             </li>
           </ul>

           <li class="resources-mobile-menu-title">
             <a>Edge</a>
           </li>

           <ul class="resources-mobile-menu-items">
             <li>
               <a href="https://pytorch.org/edge">About PyTorch Edge</a>
             </li>

             <li>
               <a href="https://pytorch.org/executorch-overview">ExecuTorch</a>
             </li>
           </ul>

           <li class="resources-mobile-menu-title">
             <a>Docs</a>
           </li>

           <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/docs/stable/index.html">PyTorch</a>
            </li>

            <li>
              <a href="https://pytorch.org/pytorch-domains">PyTorch Domains</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            <a>Blog & News</a>
          </li>

           <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/blog/">PyTorch Blog</a>
            </li>
            <li>
              <a href="https://pytorch.org/community-blog">Community Blog</a>
            </li>

            <li>
              <a href="https://pytorch.org/videos">Videos</a>
            </li>

            <li>
              <a href="https://pytorch.org/community-stories">Community Stories</a>
            </li>
            <li>
              <a href="https://pytorch.org/events">Events</a>
            </li>
          </ul>

          <li class="resources-mobile-menu-title">
            <a>About</a>
          </li>

          <ul class="resources-mobile-menu-items">
            <li>
              <a href="https://pytorch.org/foundation">PyTorch Foundation</a>
            </li>
            <li>
              <a href="https://pytorch.org/governing-board">Governing Board</a>
            </li>
          </ul>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->
</body>
  </html>

<script>
  const chevronDownIconPath = "../../../../_static/images/chevron-down-black.svg"
  const chevronRightIconPath = "../../../../_static/images/chevron-right-orange.svg"
</script>